import os


exploit_dir = "./exploits"
gitremote = "https://github.com/offensive-security/exploit-database.git"



####################### DB functions
def check_os():
    if os.name == "posix":
        return 1
    return 0


def download_db():
    if check_os() == 0:
        print("Window not supported yet")
        return
    os.system("mkdir -p {}".format(exploit_dir))
    os.system("ls {}".format(exploit_dir))

    # parsing
    stream = os.popen("git rev-parse --is-inside-work-tree")
    if stream.read() == "true":
        print("Empty directory. Good to clone")
        if os.popen("ls").read() == "":
            print("Clonning Exploit-db Repository ......")
            os.system("git clone {}".format(gitremote))
            # ok adding
            stream = os.popen("git remote -v")
            if stream.read() != gitremote:
                print("adding remote repo {}".format(gitremote))
                os.system("git init > /dev/null")
                os.system('git remote add origin "${}" 2 > /dev/null '.format(gitremote))
            # Make sure to prep checkout first
            os.system("git checkout -- .")
            # update from git
            os.system("git pull origin master")

            print("All installed")
    print("install failed")


def update_db():
    os.system("cd {}".format(exploit_dir))

    stream = os.popen("git remote -v")
    if stream.read() != gitremote:
        print("adding remote repo {}".format(gitremote))
        os.system("git init > /dev/null")
        os.system("git remote add origin {}".format(gitremote))

    os.system("git checkout --")

    os.system("git pull origin master")

    print("Updated")

